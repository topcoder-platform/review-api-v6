// Prisma client for Challenge DB (subset used for counters and read-only projections)

generator client {
  provider      = "prisma-client-js"
  // Generate a separate client so we can import it as @prisma/client-challenge
  output        = "../node_modules/@prisma/client-challenge"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("CHALLENGE_DB_URL")
}

enum ChallengeStatusEnum {
  NEW
  DRAFT
  APPROVED
  ACTIVE
  COMPLETED
  DELETED
  CANCELLED
  CANCELLED_FAILED_REVIEW
  CANCELLED_FAILED_SCREENING
  CANCELLED_ZERO_SUBMISSIONS
  CANCELLED_WINNER_UNRESPONSIVE
  CANCELLED_CLIENT_REQUEST
  CANCELLED_REQUIREMENTS_INFEASIBLE
  CANCELLED_ZERO_REGISTRATIONS
  CANCELLED_PAYMENT_FAILED
}

enum ReviewOpportunityTypeEnum {
  REGULAR_REVIEW
  COMPONENT_DEV_REVIEW
  SPEC_REVIEW
  ITERATIVE_REVIEW
  SCENARIOS_REVIEW
}

// Minimal challenge model shape expanded with read-only fields required by Review API
model Challenge {
  id                         String                     @id @db.Uuid
  name                       String
  status                     ChallengeStatusEnum
  numOfRegistrants           Int                        @default(0)
  numOfSubmissions           Int                        @default(0)
  numOfCheckpointSubmissions Int                        @default(0)
  submissionEndDate          DateTime?

  // Relations required for summary aggregations
  phases    ChallengePhase[]
  reviewers ChallengeReviewer[]
}

model ChallengePhase {
  id                 String   @id @db.Uuid
  challengeId        String   @db.Uuid
  phaseId            String   @db.Uuid
  name               String
  isOpen             Boolean?
  scheduledStartDate DateTime?
  scheduledEndDate   DateTime?
  actualStartDate    DateTime?
  actualEndDate      DateTime?

  challenge Challenge @relation(fields: [challengeId], references: [id])

  @@index([challengeId])
}

model ChallengeReviewer {
  id                  String                 @id @db.Uuid
  challengeId         String                 @db.Uuid
  scorecardId         String
  isMemberReview      Boolean
  memberReviewerCount Int?
  phaseId             String                 @db.Uuid
  basePayment         Float?
  incrementalPayment  Float?
  type                ReviewOpportunityTypeEnum?
  isAIReviewer        Boolean

  challenge Challenge @relation(fields: [challengeId], references: [id])

  @@index([challengeId])
  @@index([phaseId])
}
